type: edu
custom_name: stage6
files:
- name: translator/translator.py
  visible: true
  text: |-
    print('Type "en" if you want to translate from French into English, or "fr" if you want to translate from English into French:')
    lang = input()
    print('Type the word you want to translate:')
    word = input()
    print('You chose "%s" as the language to translate "%s" to.' % (lang, word))
  learner_created: false
- name: tests.py
  visible: false
  text: |
    from hstest.stage_test import StageTest
    from hstest.test_case import TestCase
    from hstest.check_result import CheckResult
    import requests
    from itertools import chain
    from bs4 import BeautifulSoup
    import sys
    import os


    if sys.platform.startswith("win"):
        import _locale

        # pylint: disable=protected-access
        _locale._getdefaultlocale = (lambda *args: ['en_US', 'utf8'])

    CheckResult.correct = lambda: CheckResult(True, '')
    CheckResult.wrong = lambda feedback: CheckResult(False, feedback)


    languages = ["arabic", "german", "english", "spanish", "french",
                 "hebrew", "japanese", "dutch", "polish", "portuguese",
                 "romanian", "russian", "turkish"]


    class TranslatorTest(StageTest):
        def generate(self):
            return [
                TestCase(args=['english', 'all', 'love'], attach='english\nall\nlove'),
                TestCase(args=['spanish', 'english', 'derechos'], attach='spanish\nenglish\nderechos')
            ]

        def check_output(self, output, true_results):
            output = output.lower()

            for language in true_results:
                translations_title = '{} translation'.format(language).lower()
                if translations_title not in output:
                    return False, 'The title \"{0} translation\" was not found.'.format(language)
                examples_title = "{0} example".format(language).lower()
                translations = output[output.index(translations_title):].strip()

                if examples_title not in translations.lower():
                    return False, 'The title \"{0}\" was not found.\n' \
                                  'Make sure you output this title before example sentences for this language,\n' \
                                  'and that you output it after translations for it.'.format(examples_title)

                # the beginning of the section with context examples
                examples_index = translations.index(examples_title)
                try:
                    # the end of the section with context examples
                    examples_end = translations.index('translation', examples_index)
                except ValueError:
                    # if the language is last in the list, the end of the context examples is the end of the output
                    examples_end = None
                examples = translations[examples_index:examples_end].split('\n')
                translations = translations[:examples_index].strip().split('\n')
                examples = [line for line in examples if line and examples_title not in line]
                translations = [line for line in translations if line and translations_title not in line]

                if len(translations) == 0:
                    return False, "No translations for {0} are found.\n" \
                                  "Make sure that each translated word is placed in a new line\n" \
                                  "and that translations precede examples.".format(language)

                if len(examples) == 0:
                    return False, "No context examples for {0} are found.\n" \
                                  "Make sure that your context examples follow the translations\n" \
                                  "and that each example is placed in a new line.".format(language)

                true_translations, true_examples = true_results[language]
                if true_translations == "Connection error":
                    return CheckResult.wrong("Connection error occurred while connecting to the context.reverso.net\n"
                                             "Please, try again a bit later.")

                translations_intersection = [True for user_translation in translations
                                             if user_translation in true_translations]
                if not translations_intersection:
                    return False, "No correct translations for {0} are found.\n" \
                                  "Please, output the first found translation " \
                                  "of the given word for this language if you output one translation.".format(language)

                examples_intersection = [True for user_example in examples if user_example in true_examples]
                if not examples_intersection:
                    return False, "No correct examples for {0} are found.\n" \
                                  "If you output only one example for each language,\n" \
                                  "please, use the first example that you find on the web page.".format(language)

            return True, ''

        def check(self, reply, attach):
            l1, l2, word = attach.split("\n")
            result_dict = get_results(l1, l2, word)

            file_name = word + '.txt'
            if not os.path.exists(file_name):
                return CheckResult.wrong("Looks like you didn't create a file named <word>.txt \n"
                                         "where <word> is the word that should be translated.")

            with open(file_name, 'r', encoding='utf-8') as fh:
                try:
                    output = fh.read()
                except UnicodeDecodeError:
                    return CheckResult.wrong("UnicodeDecodeError occurred while reading your file. \n"
                                             "Perhaps you used the wrong encoding? Please, use utf-8 encoding.")

            if output.lower().strip() not in reply.lower().strip():
                return CheckResult.wrong("The output to the terminal does not seem to contain the content of the file.\n"
                                         "Please make sure that you output the results to the terminal as well.\n"
                                         "Also, make sure that the output to the terminal contains all the data written to the file unmodified.")

            is_correct, feedback = self.check_output(output, result_dict)
            if not is_correct:
                if "Connection error" not in feedback:
                    feedback = 'A problem occurred while reading the file that you created.\n' + feedback
                return CheckResult.wrong(feedback)

            try:
                os.remove(file_name)
            except:
                return CheckResult.wrong("An error occurred while your file was being removed.\n"
                                         "Please make sure that you close all the files after writing the results in them.")

            return CheckResult.correct()


    def get_results(l1, l2, word):
        if l2 == 'all':
            target_languages = [language for language in languages if language != l1]
        else:
            target_languages = [l2]

        result_dict = {}

        for lang_to in target_languages:
            url = f"https://context.reverso.net/translation/{l1}-{lang_to}/{word}"
            user_agent = 'Mozilla/5.0'
            try:
                response = requests.get(url, timeout=10, headers={'User-Agent': user_agent})
            except requests.exceptions.ReadTimeout:
                return "Connection error", "Connection error"
            except requests.exceptions.ConnectionError:
                return "Connection error", "Connection error"

            raw_contents = BeautifulSoup(response.content, 'html.parser')
            translations = raw_contents.find_all('a', {"class": 'translation'})
            sentences_src, sentences_target = \
                raw_contents.find_all('div', {"class": "src ltr"}), \
                raw_contents.find_all('div', {"class": ["trg ltr", "trg rtl arabic", "trg rtl"]})

            translation_list = [translation.get_text().strip().lower() for translation in translations]
            sentence_list = [sentence.get_text().strip().lower() for sentence in
                             list(chain(*[sentence_pair for sentence_pair in zip(sentences_src, sentences_target)]))]
            result_dict[lang_to] = [set(translation_list), set(sentence_list)]

        return result_dict


    if __name__ == '__main__':
        TranslatorTest('translator.translator').run_tests()
  learner_created: false
- name: translator/revista.txt
  visible: true
  text: |+
    Arabic Translation:
    مجلة

    Arabic Example:
    Esto es de la revista "Nature".
    هذا اقتراح تم الحديث حوله في أوروبا كان ذلك من مجلة "Nature".

    German Translation:
    Zeitschrift

    German Example:
    Así que decidí crear mi propia revista.
    Also habe ich beschlossen, meine eigene Zeitschrift zu gründen.

    English Translation:
    magazine

    English Example:
    Edita la revista El Ingeniero Sirio.
    It issues a magazine called The Syrian Engineer.

    French Translation:
    magazine

    French Example:
    Imprimieron toda la revista al revés.
    Ils ont imprimé le magazine entier à l'envers.

  learner_created: true
- name: translator/fuera.txt
  visible: true
  text: |+
    Arabic Translation:
    خارج

    Arabic Example:
    Darkwood había trasladado un segundo armazón fuera del hangar para nuevos trabajos.
    ونقلت شركة Darkwood هيكل الجسم الثاني إلى خارج الحظيرة لإجراء المزيد من العمل.

    German Translation:
    draußen

    German Example:
    Es obvio que miras dentro desde fuera.
    Es ist offensichtlich, dass Sie draußen sind und nach innen schauen.

    English Translation:
    out

    English Example:
    Tendremos que llevarlo fuera del edificio.
    We'll have them carry it out of the building.

    French Translation:
    dehors

    French Example:
    Ahora, necesito estar fuera protegiéndolas.
    Maintenant, il faut que je sois dehors pour les protéger.

    Hebrew Translation:
    בחוץ

    Hebrew Example:
    Tarzán avanza. Troyzan está fuera.
    טרזן ממשיך הלאה, טרויזן בחוץ, ללא סיכוי לחסינות.

    Japanese Translation:
    外に

    Japanese Example:
    Hay gente fuera leal a mi.
    外には、私に忠実な人間が居る

    Dutch Translation:
    buiten

    Dutch Example:
    Otras acciones anuales fuera del programa marco.
    Andere jaarlijkse werkzaamheden buiten het kaderprogramma (APAS).

    Polish Translation:
    poza

    Polish Example:
    Nunca esperé que fuera así de difícil.
    Nie spodziewałem się, że to będzie tak ciężkie.

    Portuguese Translation:
    fora

    Portuguese Example:
    Sería absurdo negar que fuera está lloviendo.
    Seria absurdo negar que está a chover lá fora.

    Romanian Translation:
    afară

    Romanian Example:
    Probablemente porque estuviste fuera del margen esos 6 meses.
    Probabil din cauza ca ai fost afara din sediu timp de 6 luni.

    Russian Translation:
    снаружи

    Russian Example:
    Al llegar vi que reparaban una nave alienígena fuera.
    Когда мы пристыковались, я увидел инопланетный корабль, пришвартованный снаружи.

    Turkish Translation:
    dışarıda

    Turkish Example:
    Perdóneme por ofrecerle el té fuera.
    Size dışarıda çay ikram ettiğim için ben bağışlayın.

  learner_created: true
- name: translator/pantalla.txt
  visible: true
  text: |+
    Arabic Translation:
    شاشة

    Arabic Example:
    Aparecerá en la pantalla de televisión.
    الخروج، باتمان، على الدائرة المغلقة شاشة التلفزيون.

    German Translation:
    Bildschirm

    German Example:
    Podía compartir información mirando a una pantalla.
    Er konnte Informationen mitteilen, indem er auf einen Bildschirm sah.

  learner_created: true
- name: translator/esquina.txt
  visible: true
  text: |
    English Translation:
    corner

    English Example:
    EEUU espera el tiro de esquina.
    Everyone waits for the beat of the corner.
  learner_created: true
- name: translator/flecha.txt
  visible: true
  text: |+
    Arabic Translation:
    سهم

    Arabic Example:
    ¿Tienes una flecha india de verdad?
    هل لديك سهم هندي حقيقي - ليس لدي.؟

    German Translation:
    Pfeil

    German Example:
    La flecha en mi espalda me despertó.
    Nun, der Pfeil in meinen Rücken weckte mich.

    English Translation:
    arrow

    English Example:
    No quería ser una flecha apuntándote.
    I wouldn't be a blazing arrow pointing the way to you.

    French Translation:
    flèche

    French Example:
    Y recobramos al menos una flecha.
    Et on a récupéré au moins une flèche.

    Hebrew Translation:
    חץ

    Hebrew Example:
    âªRoba mi corazón con tu flecha de amor
    "לגנוב את הלב שלי עם חץ האהבה שלך"

    Japanese Translation:
    矢印

    Japanese Example:
    Las teclas de flecha para jugar.
    プレイするには、矢印キーを使用してください。

    Dutch Translation:
    pijl

    Dutch Example:
    Usa la flecha hacia arriba para avanzar.
    Gebruik de pijl naar boven om vooruit te gaan.

    Polish Translation:
    strzała

    Polish Example:
    No hay flecha que penetre la armadura del gigante.
    Żadna strzała nie przebije pancerza tego olbrzyma.

    Portuguese Translation:
    seta

    Portuguese Example:
    Dibujé una flecha hasta donde está dormitorio.
    Eu atirei uma seta até onde está o meu quarto.

    Romanian Translation:
    săgeată

    Romanian Example:
    Necesitas ambas para coger la flecha.
    Ai nevoie de amandoua pentru a aduce săgeata.

    Russian Translation:
    стрела

    Russian Example:
    Mark, Cindy tiene una flecha.
    Марк. Синди - у нее есть стрела.

    Turkish Translation:
    ok

    Turkish Example:
    Aunque la flecha es corta... es precisa y muy fuerte.
    Ok kısa olmasına rağmen hassas ve çok güçlüdür.

  learner_created: true
- name: translator/dedo.txt
  visible: true
  text: |
    English Translation:
    finger

    English Example:
    Cuando llegué me enseñó el dedo.
    He gave me the finger when I came in.
  learner_created: true
feedback_link: https://hyperskill.org/projects/99/stages/548/implement#comment
status: Unchecked
record: -1
